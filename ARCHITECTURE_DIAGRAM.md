# ğŸ—ï¸ System Architecture Diagram

## High-Level Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            USER'S BROWSER                              â”‚
â”‚                          (localhost:3000)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ WebSocket
                                    â”‚ (bidirectional)
                                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          PYTHON BACKEND                                â”‚
â”‚                          (localhost:8000)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Detailed Frontend Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND (React)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  Video Element   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ requestAnimation   â”‚                  â”‚
â”‚  â”‚  (Webcam 640x480)â”‚  60 FPS â”‚ Frame Loop         â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                        â”‚                                â”‚
â”‚                                        â–¼                                â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚                              â”‚  Capture Frame   â”‚                      â”‚
â”‚                              â”‚  â€¢ Draw to canvasâ”‚                      â”‚
â”‚                              â”‚  â€¢ toDataURL()   â”‚                      â”‚
â”‚                              â”‚  â€¢ Base64 encode â”‚                      â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                        â”‚                                â”‚
â”‚                                        â–¼                                â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚                         â”‚  socket.emit('frame', {})   â”‚                â”‚
â”‚                         â”‚  â€¢ Fire and forget          â”‚                â”‚
â”‚                         â”‚  â€¢ Non-blocking             â”‚                â”‚
â”‚                         â”‚  â€¢ Sequence number          â”‚                â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                        â”‚                                â”‚
â”‚                                        â”‚ WebSocket                      â”‚
â”‚                                        â–¼                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚                 Asynchronous Flow                        â”‚          â”‚
â”‚  â”‚  (Frame sent, loop continues immediately)                â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                        â”‚                                â”‚
â”‚                                        â–¼                                â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚              â”‚  getInterpolatedResult()             â”‚                  â”‚
â”‚              â”‚  â€¢ Blend last 2 results              â”‚                  â”‚
â”‚              â”‚  â€¢ Calculate time factor (t)         â”‚                  â”‚
â”‚              â”‚  â€¢ Linear interpolation              â”‚                  â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                        â”‚                                â”‚
â”‚                                        â–¼                                â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚                         â”‚  drawSkeleton()          â”‚                   â”‚
â”‚                         â”‚  â€¢ Draw body (pink)      â”‚                   â”‚
â”‚                         â”‚  â€¢ Draw hands (teal)     â”‚                   â”‚
â”‚                         â”‚  â€¢ Draw connections      â”‚                   â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                        â”‚                                â”‚
â”‚                                        â”‚                                â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚              â”‚  Result arrives via WebSocket     â”‚                     â”‚
â”‚              â”‚  socket.on('pose_result', ...)    â”‚                     â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜                     â”‚
â”‚                                        â”‚        â”‚                       â”‚
â”‚                                        â–¼        â”‚                       â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                       â”‚
â”‚              â”‚  Store as latestResult     â”‚    â”‚                       â”‚
â”‚              â”‚  Store as previousResult   â”‚    â”‚                       â”‚
â”‚              â”‚  Update performance metricsâ”‚    â”‚                       â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                       â”‚
â”‚                                                 â”‚                       â”‚
â”‚                                        Loop back to top @ 60 FPS       â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Detailed Backend Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       BACKEND (Flask-SocketIO)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚              RECEIVER THREAD (Main Thread)                 â”‚        â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
â”‚  â”‚                                                             â”‚        â”‚
â”‚  â”‚  @socketio.on('frame')                                     â”‚        â”‚
â”‚  â”‚         â”‚                                                   â”‚        â”‚
â”‚  â”‚         â–¼                                                   â”‚        â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚        â”‚
â”‚  â”‚  â”‚ Receive frame    â”‚â—€â”€â”€â”€â”€ WebSocket from frontend         â”‚        â”‚
â”‚  â”‚  â”‚ â€¢ image (base64) â”‚                                      â”‚        â”‚
â”‚  â”‚  â”‚ â€¢ timestamp      â”‚                                      â”‚        â”‚
â”‚  â”‚  â”‚ â€¢ sequence       â”‚                                      â”‚        â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚        â”‚
â”‚  â”‚         â”‚                                                   â”‚        â”‚
â”‚  â”‚         â–¼                                                   â”‚        â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚        â”‚
â”‚  â”‚  â”‚  frame_buffer.put()              â”‚                      â”‚        â”‚
â”‚  â”‚  â”‚  â€¢ Overwrites old frame          â”‚                      â”‚        â”‚
â”‚  â”‚  â”‚  â€¢ Thread-safe (mutex lock)      â”‚                      â”‚        â”‚
â”‚  â”‚  â”‚  â€¢ Increments dropped counter    â”‚                      â”‚        â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚        â”‚
â”‚  â”‚         â”‚                                                   â”‚        â”‚
â”‚  â”‚         â”‚ Returns immediately (non-blocking)               â”‚        â”‚
â”‚  â”‚                                                             â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚          LATEST-WINS BUFFER (Thread-Safe)                  â”‚        â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
â”‚  â”‚                                                             â”‚        â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚        â”‚
â”‚  â”‚  â”‚  Single Slot: [frame_data or None]     â”‚              â”‚        â”‚
â”‚  â”‚  â”‚  â€¢ Lock: threading.Lock()                â”‚              â”‚        â”‚
â”‚  â”‚  â”‚  â€¢ dropped_count: int                    â”‚              â”‚        â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚        â”‚
â”‚  â”‚              â–²                    â”‚                         â”‚        â”‚
â”‚  â”‚              â”‚ put()              â”‚ get()                  â”‚        â”‚
â”‚  â”‚              â”‚                    â–¼                         â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                 â”‚                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚           INFERENCE THREAD (Separate Thread)                â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚                                                              â”‚      â”‚
â”‚  â”‚  while inference_running:                                   â”‚      â”‚
â”‚  â”‚      â”‚                                                       â”‚      â”‚
â”‚  â”‚      â–¼                                                       â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚      â”‚
â”‚  â”‚  â”‚ frame_data = buffer  â”‚                                   â”‚      â”‚
â”‚  â”‚  â”‚         .get()       â”‚                                   â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚      â”‚
â”‚  â”‚      â”‚                                                       â”‚      â”‚
â”‚  â”‚      â”‚ if None: sleep(1ms) and continue                     â”‚      â”‚
â”‚  â”‚      â”‚                                                       â”‚      â”‚
â”‚  â”‚      â–¼                                                       â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚      â”‚
â”‚  â”‚  â”‚ Decode base64        â”‚  ~2ms                             â”‚      â”‚
â”‚  â”‚  â”‚ â€¢ np.frombuffer()    â”‚                                   â”‚      â”‚
â”‚  â”‚  â”‚ â€¢ cv2.imdecode()     â”‚                                   â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚      â”‚
â”‚  â”‚      â”‚                                                       â”‚      â”‚
â”‚  â”‚      â–¼                                                       â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚      â”‚
â”‚  â”‚  â”‚ Downscale            â”‚  ~1ms                             â”‚      â”‚
â”‚  â”‚  â”‚ â€¢ Target: 384px      â”‚                                   â”‚      â”‚
â”‚  â”‚  â”‚ â€¢ cv2.resize()       â”‚                                   â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚      â”‚
â”‚  â”‚      â”‚                                                       â”‚      â”‚
â”‚  â”‚      â–¼                                                       â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚      â”‚
â”‚  â”‚  â”‚ Convert to RGB       â”‚                                   â”‚      â”‚
â”‚  â”‚  â”‚ Generate monotonic   â”‚                                   â”‚      â”‚
â”‚  â”‚  â”‚ timestamp            â”‚                                   â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚      â”‚
â”‚  â”‚      â”‚                                                       â”‚      â”‚
â”‚  â”‚      â–¼                                                       â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚      â”‚
â”‚  â”‚  â”‚ pose.process()       â”‚  ~15ms                            â”‚      â”‚
â”‚  â”‚  â”‚ â€¢ LIVE_STREAM mode   â”‚                                   â”‚      â”‚
â”‚  â”‚  â”‚ â€¢ Returns landmarks  â”‚                                   â”‚      â”‚
â”‚  â”‚  â”‚ â€¢ Returns world 3D   â”‚                                   â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚      â”‚
â”‚  â”‚      â”‚                                                       â”‚      â”‚
â”‚  â”‚      â–¼                                                       â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚      â”‚
â”‚  â”‚  â”‚ Calculate 3D angles  â”‚  ~1ms                             â”‚      â”‚
â”‚  â”‚  â”‚ â€¢ Elbow, knee, hip   â”‚                                   â”‚      â”‚
â”‚  â”‚  â”‚ â€¢ Extract 3D coords  â”‚                                   â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚      â”‚
â”‚  â”‚      â”‚                                                       â”‚      â”‚
â”‚  â”‚      â–¼                                                       â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚      â”‚
â”‚  â”‚  â”‚ hands.process()      â”‚  ~10ms                            â”‚      â”‚
â”‚  â”‚  â”‚ â€¢ Detect both hands  â”‚                                   â”‚      â”‚
â”‚  â”‚  â”‚ â€¢ 21 landmarks each  â”‚                                   â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚      â”‚
â”‚  â”‚      â”‚                                                       â”‚      â”‚
â”‚  â”‚      â–¼                                                       â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚      â”‚
â”‚  â”‚  â”‚ EMA Smoothing        â”‚  ~1ms                             â”‚      â”‚
â”‚  â”‚  â”‚ â€¢ Body (Î±=0.7)       â”‚                                   â”‚      â”‚
â”‚  â”‚  â”‚ â€¢ Hands (Î±=0.7)      â”‚                                   â”‚      â”‚
â”‚  â”‚  â”‚ â€¢ 3D angles (Î±=0.7)  â”‚                                   â”‚      â”‚
â”‚  â”‚  â”‚ â€¢ 3D coords (Î±=0.7)  â”‚                                   â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚      â”‚
â”‚  â”‚      â”‚                                                       â”‚      â”‚
â”‚  â”‚      â–¼                                                       â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚      â”‚
â”‚  â”‚  â”‚ socketio.emit        â”‚                                   â”‚      â”‚
â”‚  â”‚  â”‚ ('pose_result')      â”‚                                   â”‚      â”‚
â”‚  â”‚  â”‚ â€¢ body landmarks     â”‚                                   â”‚      â”‚
â”‚  â”‚  â”‚ â€¢ hand landmarks     â”‚                                   â”‚      â”‚
â”‚  â”‚  â”‚ â€¢ 3D angles          â”‚                                   â”‚      â”‚
â”‚  â”‚  â”‚ â€¢ 3D coords          â”‚                                   â”‚      â”‚
â”‚  â”‚  â”‚ â€¢ timings            â”‚                                   â”‚      â”‚
â”‚  â”‚  â”‚ â€¢ sequence           â”‚                                   â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚      â”‚
â”‚  â”‚      â”‚                                                       â”‚      â”‚
â”‚  â”‚      â”‚ WebSocket                                            â”‚      â”‚
â”‚  â”‚      â–¼                                                       â”‚      â”‚
â”‚  â”‚  Back to frontend â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚      â”‚
â”‚  â”‚                                                              â”‚      â”‚
â”‚  â”‚  Loop back to get() @ ~24 FPS                               â”‚      â”‚
â”‚  â”‚                                                              â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
â”‚                                                                         â”‚
â”‚  Total Backend Time: ~30ms (â‰ˆ 33 FPS max, runs at ~24 FPS)             â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Timing Diagram

```
Time (ms)  Frontend                   Buffer        Backend
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0          Capture frame
2          Send via WebSocket â”€â”€â”€â”€â”€â”€â”€â”€â–¶ put() â”€â”€â”€â”€â–¶ [waiting...]
           
           Continue loop...
           getInterpolated()
           drawSkeleton()
16         Capture frame (60 FPS)
18         Send via WebSocket â”€â”€â”€â”€â”€â”€â”€â”€â–¶ put() â”€â”€â”€â”€â–¶ [waiting...]
                                      (drops prev)
           
32         Capture frame
34         Send via WebSocket â”€â”€â”€â”€â”€â”€â”€â”€â–¶ put() â”€â”€â”€â”€â–¶ get() â”€â”€â”€â”€â”
                                                               â”‚
                                                               â–¼
                                                          Decode (2ms)
                                                          Downscale (1ms)
                                                          Pose (15ms)
                                                          3D (1ms)
                                                          Hands (10ms)
                                                          Smooth (1ms)
                                                               â”‚
48         Capture frame                                       â”‚
50         Send via WebSocket â”€â”€â”€â”€â”€â”€â”€â”€â–¶ put() â”€â”€â”€â”€â–¶ [busy...] â”‚
                                      (drops prev)             â”‚
                                                               â”‚
64         Capture frame                                       â”‚
66         Send via WebSocket â”€â”€â”€â”€â”€â”€â”€â”€â–¶ put() â”€â”€â”€â”€â–¶ [busy...] â”‚
                                      (drops prev)             â”‚
                                                               â–¼
68         â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Result! (30ms total)
           Update latestResult
           Continue interpolating...
           
           
Timeline Summary:
â€¢ Frontend sends every ~16ms (60 FPS)
â€¢ Backend processes every ~40ms (24 FPS)
â€¢ Buffer drops ~60% of frames (by design!)
â€¢ Frontend interpolates for smooth 60 FPS display
```

---

## Thread Safety

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Thread Synchronization                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Main Thread                    Inference Thread            â”‚
â”‚  (WebSocket Receiver)           (Pose Processing)           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”‚
â”‚         â”‚                              â”‚                     â”‚
â”‚         â”‚                              â”‚                     â”‚
â”‚         â–¼                              â–¼                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Acquire lockâ”‚              â”‚ Acquire lockâ”‚              â”‚
â”‚  â”‚ Write bufferâ”‚              â”‚ Read buffer â”‚              â”‚
â”‚  â”‚ Release lockâ”‚              â”‚ Clear bufferâ”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ Release lockâ”‚              â”‚
â”‚         â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚                              â”‚                     â”‚
â”‚         â”‚                              â”‚                     â”‚
â”‚         â–¼                              â–¼                     â”‚
â”‚   Return fast                    Process slow               â”‚
â”‚   (~0.1ms)                        (~30ms)                   â”‚
â”‚                                                              â”‚
â”‚  No blocking! Threads never wait for each other.            â”‚
â”‚  Lock held for microseconds only.                           â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Why This Works

### âœ… No Timestamp Errors
```
Backend generates monotonic timestamps:
  Frame 1: timestamp = 1000000
  Frame 2: timestamp = 1000001
  Frame 3: timestamp = 1000002
  
MediaPipe receives strictly increasing timestamps âœ“
No "packet timestamp mismatch" errors âœ“
```

### âœ… No Buffer Overflow
```
Buffer size = 1 (not 10, not 100, just 1)
  
When full: overwrite old frame
  put(frame_1) â†’ buffer = [frame_1]
  put(frame_2) â†’ buffer = [frame_2]  (frame_1 dropped)
  put(frame_3) â†’ buffer = [frame_3]  (frame_2 dropped)
  
No unbounded growth âœ“
Intentional controlled dropping âœ“
```

### âœ… Smooth Rendering
```
Inference:  24 FPS (updates every ~40ms)
Rendering:  60 FPS (updates every ~16ms)

Between inference results, interpolate:
  t=0.00 â†’ 100% previous result
  t=0.25 â†’ 75% previous + 25% latest
  t=0.50 â†’ 50% previous + 50% latest
  t=0.75 â†’ 25% previous + 75% latest
  t=1.00 â†’ 100% latest result
  
Smooth motion despite slower inference âœ“
```

---

## Summary

This architecture achieves:
- âœ… **Stability:** No timestamp errors, no crashes
- âœ… **Performance:** 40-60ms latency, ~24 FPS inference
- âœ… **Quality:** Smooth 60 FPS rendering, EMA smoothing
- âœ… **Simplicity:** Clean separation of concerns
- âœ… **Scalability:** Can handle faster inputs gracefully

**Production ready!** ğŸš€

